<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vitalia ‚Äî Bienvenue !</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,500;0,9..144,700;1,9..144,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --cream: #FAF7F2;
  --warm-white: #FFFEF9;
  --terracotta: #C4714A;
  --dusty-rose: #D4936A;
  --peach: #F2C4A0;
  --sage: #7A9E7E;
  --sage-light: #A8C5AC;
  --golden: #E8B84B;
  --deep-brown: #3D2B1F;
  --mid-brown: #7A5C4A;
  --text-light: #9E8070;
  --mirtille: #8E44AD;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--cream);
  color: var(--deep-brown);
  min-height: 100vh;
  overflow: hidden;
}

/* ‚îÄ‚îÄ BACKGROUND ‚îÄ‚îÄ */
body::before {
  content: '';
  position: fixed; inset: 0;
  background:
    radial-gradient(ellipse at 15% 15%, rgba(196,113,74,0.07) 0%, transparent 50%),
    radial-gradient(ellipse at 85% 85%, rgba(122,158,126,0.09) 0%, transparent 50%);
  pointer-events: none; z-index: 0;
}

/* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
.progress-bar {
  position: fixed; top: 0; left: 0; right: 0;
  height: 4px; background: rgba(196,113,74,0.15);
  z-index: 100;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--terracotta), var(--golden));
  border-radius: 0 2px 2px 0;
  transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* ‚îÄ‚îÄ STEP COUNTER ‚îÄ‚îÄ */
.step-counter {
  position: fixed; top: 16px; left: 50%; transform: translateX(-50%);
  z-index: 100;
  display: flex; gap: 6px; align-items: center;
}

.step-dot {
  width: 6px; height: 6px;
  background: rgba(196,113,74,0.2);
  border-radius: 50%;
  transition: all 0.3s;
}

.step-dot.active {
  background: var(--terracotta);
  width: 18px;
  border-radius: 3px;
}

.step-dot.done {
  background: var(--sage);
}

/* ‚îÄ‚îÄ SKIP BUTTON ‚îÄ‚îÄ */
.skip-btn {
  position: fixed; top: 16px; right: 20px;
  z-index: 100;
  background: none; border: none;
  font-family: 'DM Sans', sans-serif;
  font-size: 14px; color: var(--text-light);
  cursor: pointer; padding: 4px 8px;
  border-radius: 8px;
  transition: all 0.2s;
  text-decoration: underline;
  text-underline-offset: 3px;
}

.skip-btn:hover { color: var(--mid-brown); }
.skip-btn.hidden { opacity: 0; pointer-events: none; }

/* ‚îÄ‚îÄ SCREEN CONTAINER ‚îÄ‚îÄ */
.screens-wrapper {
  position: relative;
  width: 100%; height: 100vh;
  overflow: hidden;
}

.screen {
  position: absolute; inset: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 80px 28px 100px;
  opacity: 0;
  transform: translateX(60px);
  transition: all 0.45s cubic-bezier(0.34, 1.56, 0.64, 1);
  pointer-events: none;
  overflow-y: auto;
}

.screen.active {
  opacity: 1; transform: translateX(0);
  pointer-events: all;
}

.screen.exit {
  opacity: 0; transform: translateX(-60px);
  pointer-events: none;
}

/* ‚îÄ‚îÄ MASCOT ‚îÄ‚îÄ */
.mascot-container {
  margin-bottom: 20px;
  position: relative;
  display: flex;
  align-items: flex-start;
  min-width: 300px;
}

.mascot-bubble {
  position: absolute;
  top: 8px; left: 108px;
  background: var(--warm-white);
  border: 1.5px solid rgba(196,113,74,0.2);
  border-radius: 4px 16px 16px 16px;
  padding: 10px 14px;
  font-size: 13px;
  color: var(--mid-brown);
  box-shadow: 0 4px 16px rgba(61,43,31,0.08);
  animation: bubble-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) both;
  max-width: 175px;
  white-space: normal;
  line-height: 1.45;
  z-index: 10;
}

@keyframes bubble-pop {
  from { opacity: 0; transform: scale(0.7) translateY(10px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.mascot-svg {
  width: 100px; height: 100px;
  animation: mascot-bounce 2.5s ease-in-out infinite;
  filter: drop-shadow(0 8px 16px rgba(61,43,31,0.12));
}

@keyframes mascot-bounce {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-8px) rotate(2deg); }
}

/* ‚îÄ‚îÄ SCREEN CONTENT ‚îÄ‚îÄ */
.screen-title {
  font-family: 'Fraunces', serif;
  font-size: 28px; font-weight: 700;
  color: var(--deep-brown);
  text-align: center;
  line-height: 1.3;
  margin-bottom: 8px;
}

.screen-subtitle {
  font-size: 15px; color: var(--text-light);
  text-align: center; line-height: 1.5;
  margin-bottom: 32px;
  max-width: 320px;
}

/* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
.input-field {
  width: 100%; max-width: 360px;
  background: var(--warm-white);
  border: 2px solid rgba(196,113,74,0.15);
  border-radius: 16px;
  padding: 16px 20px;
  font-family: 'DM Sans', sans-serif;
  font-size: 16px; color: var(--deep-brown);
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
  margin-bottom: 12px;
  display: block;
}

.input-field:focus {
  border-color: var(--terracotta);
  box-shadow: 0 0 0 4px rgba(196,113,74,0.08);
}

.input-field::placeholder { color: var(--text-light); }

.input-row {
  display: flex; gap: 10px; width: 100%; max-width: 360px;
  margin-bottom: 12px;
}

.input-row .input-field { margin-bottom: 0; }

/* ‚îÄ‚îÄ CHIPS GRID ‚îÄ‚îÄ */
.chips-grid {
  display: flex; flex-wrap: wrap; gap: 10px;
  justify-content: center;
  max-width: 380px;
  margin-bottom: 12px;
}

.chip {
  background: var(--warm-white);
  border: 2px solid rgba(196,113,74,0.15);
  border-radius: 50px;
  padding: 10px 18px;
  font-family: 'DM Sans', sans-serif;
  font-size: 14px; font-weight: 500;
  color: var(--mid-brown);
  cursor: pointer;
  transition: all 0.2s;
  display: flex; align-items: center; gap: 6px;
  user-select: none;
}

.chip:hover {
  border-color: var(--terracotta);
  background: rgba(196,113,74,0.05);
}

.chip.selected {
  background: var(--terracotta);
  border-color: var(--terracotta);
  color: white;
  box-shadow: 0 4px 12px rgba(196,113,74,0.25);
}

.chip.chip-sage.selected {
  background: var(--sage);
  border-color: var(--sage);
  box-shadow: 0 4px 12px rgba(122,158,126,0.25);
}

/* ‚îÄ‚îÄ BLOOD GROUP GRID ‚îÄ‚îÄ */
.blood-grid {
  display: grid; grid-template-columns: repeat(4, 1fr);
  gap: 10px; width: 100%; max-width: 360px;
  margin-bottom: 12px;
}

.blood-chip {
  background: var(--warm-white);
  border: 2px solid rgba(196,113,74,0.15);
  border-radius: 14px;
  padding: 16px 8px;
  font-family: 'Fraunces', serif;
  font-size: 18px; font-weight: 700;
  color: var(--mid-brown);
  cursor: pointer;
  text-align: center;
  transition: all 0.2s;
  user-select: none;
}

.blood-chip:hover { border-color: var(--terracotta); }

.blood-chip.selected {
  background: linear-gradient(135deg, #C0392B, #E74C3C);
  border-color: #C0392B;
  color: white;
  box-shadow: 0 4px 14px rgba(192,57,43,0.3);
}

.blood-sub {
  font-family: 'DM Sans', sans-serif;
  font-size: 10px; font-weight: 400;
  display: block; margin-top: 2px;
  opacity: 0.75;
}

/* ‚îÄ‚îÄ TOGGLE CARDS ‚îÄ‚îÄ */
.toggle-card {
  width: 100%; max-width: 360px;
  background: var(--warm-white);
  border: 2px solid rgba(196,113,74,0.12);
  border-radius: 18px;
  padding: 16px 20px;
  display: flex; align-items: center; justify-content: space-between;
  cursor: pointer; margin-bottom: 10px;
  transition: all 0.2s;
  user-select: none;
}

.toggle-card:hover { border-color: rgba(196,113,74,0.3); }

.toggle-card.active {
  border-color: var(--terracotta);
  background: rgba(196,113,74,0.04);
}

.toggle-card-left {
  display: flex; align-items: center; gap: 12px;
}

.toggle-card-emoji { font-size: 24px; }

.toggle-card-text strong {
  display: block; font-size: 15px; font-weight: 600;
  color: var(--deep-brown);
}

.toggle-card-text span {
  font-size: 12px; color: var(--text-light);
}

.toggle-switch {
  width: 44px; height: 26px;
  background: rgba(196,113,74,0.15);
  border-radius: 13px;
  position: relative;
  transition: background 0.2s;
  flex-shrink: 0;
}

.toggle-switch::after {
  content: '';
  position: absolute;
  top: 3px; left: 3px;
  width: 20px; height: 20px;
  background: white;
  border-radius: 50%;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform 0.2s;
}

.toggle-card.active .toggle-switch {
  background: var(--terracotta);
}

.toggle-card.active .toggle-switch::after {
  transform: translateX(18px);
}

/* ‚îÄ‚îÄ SLIDER ‚îÄ‚îÄ */
.slider-container {
  width: 100%; max-width: 360px;
  margin-bottom: 20px;
}

.slider-label {
  display: flex; justify-content: space-between;
  margin-bottom: 10px;
}

.slider-label span {
  font-size: 13px; color: var(--text-light);
}

.slider-value {
  font-family: 'Fraunces', serif;
  font-size: 28px; font-weight: 700;
  color: var(--terracotta);
  text-align: center;
  margin-bottom: 8px;
}

.slider-unit {
  font-size: 14px; color: var(--text-light);
  font-family: 'DM Sans', sans-serif;
}

input[type="range"] {
  width: 100%; -webkit-appearance: none;
  height: 6px; border-radius: 3px;
  background: linear-gradient(90deg, var(--terracotta) var(--pct, 50%), rgba(196,113,74,0.15) var(--pct, 50%));
  outline: none; cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 24px; height: 24px;
  border-radius: 50%;
  background: var(--terracotta);
  box-shadow: 0 2px 8px rgba(196,113,74,0.4);
  cursor: pointer;
  transition: transform 0.15s;
}

input[type="range"]::-webkit-slider-thumb:hover {
  transform: scale(1.15);
}

/* ‚îÄ‚îÄ WARNING CARD ‚îÄ‚îÄ */
.warning-card {
  width: 100%; max-width: 360px;
  background: rgba(232,184,75,0.08);
  border: 1.5px solid rgba(232,184,75,0.3);
  border-radius: 16px;
  padding: 14px 16px;
  display: flex; gap: 10px;
  margin-bottom: 16px;
  font-size: 13px; color: var(--mid-brown);
  line-height: 1.5;
}

/* ‚îÄ‚îÄ NAV BUTTONS ‚îÄ‚îÄ */
.nav-bar {
  position: fixed; bottom: 0; left: 0; right: 0;
  padding: 16px 28px 32px;
  display: flex; gap: 12px;
  background: linear-gradient(transparent, var(--cream) 40%);
  z-index: 50;
}

.btn-next {
  flex: 1;
  background: linear-gradient(135deg, var(--terracotta), var(--dusty-rose));
  color: white; border: none;
  border-radius: 18px; padding: 18px;
  font-family: 'DM Sans', sans-serif;
  font-size: 16px; font-weight: 600;
  cursor: pointer;
  box-shadow: 0 6px 24px rgba(196,113,74,0.3);
  transition: all 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 8px;
}

.btn-next:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(196,113,74,0.4);
}

.btn-back {
  width: 56px; height: 56px;
  background: var(--warm-white);
  border: 2px solid rgba(196,113,74,0.15);
  border-radius: 18px; cursor: pointer;
  font-size: 20px; color: var(--mid-brown);
  transition: all 0.2s; flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
}

.btn-back:hover { border-color: var(--terracotta); }
.btn-back.hidden { opacity: 0; pointer-events: none; }

/* ‚îÄ‚îÄ WELCOME SCREEN SPECIAL ‚îÄ‚îÄ */
.welcome-hero {
  text-align: center;
  display: flex; flex-direction: column; align-items: center;
}

.app-logo {
  font-family: 'Fraunces', serif;
  font-size: 42px; font-weight: 700;
  color: var(--terracotta);
  margin-bottom: 4px;
}

.app-logo span { color: var(--sage); }

.app-tagline {
  font-size: 14px; color: var(--text-light);
  letter-spacing: 1px; text-transform: uppercase;
  margin-bottom: 32px;
}

.welcome-mascots {
  display: flex; gap: 12px; margin-bottom: 28px;
  align-items: flex-end;
}

.welcome-mascot {
  animation: mascot-bounce 2.5s ease-in-out infinite;
}

.welcome-mascot:nth-child(2) {
  animation-delay: 0.4s;
  transform: scale(1.1);
}

.welcome-mascot:nth-child(3) {
  animation-delay: 0.8s;
}

/* ‚îÄ‚îÄ SUCCESS SCREEN ‚îÄ‚îÄ */
.success-circle {
  width: 100px; height: 100px;
  background: linear-gradient(135deg, var(--sage), var(--sage-light));
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 46px;
  margin-bottom: 24px;
  box-shadow: 0 8px 30px rgba(122,158,126,0.3);
  animation: success-pop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

@keyframes success-pop {
  from { opacity: 0; transform: scale(0.3); }
  to { opacity: 1; transform: scale(1); }
}

.profile-summary {
  width: 100%; max-width: 360px;
  background: var(--warm-white);
  border-radius: 20px;
  padding: 20px;
  border: 1.5px solid rgba(196,113,74,0.12);
  margin-bottom: 16px;
}

.summary-row {
  display: flex; justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid rgba(196,113,74,0.08);
  font-size: 14px;
}

.summary-row:last-child { border-bottom: none; }
.summary-label { color: var(--text-light); }
.summary-value { color: var(--deep-brown); font-weight: 600; text-align: right; max-width: 200px; }

/* ‚îÄ‚îÄ LOADING OVERLAY ‚îÄ‚îÄ */
.save-overlay {
  position: fixed; inset: 0;
  background: var(--cream);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  z-index: 200; gap: 20px;
  opacity: 0; pointer-events: none;
  transition: opacity 0.3s;
}

.save-overlay.active {
  opacity: 1; pointer-events: all;
}

.save-spinner {
  width: 50px; height: 50px;
  border: 4px solid rgba(196,113,74,0.15);
  border-top-color: var(--terracotta);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.save-text {
  font-family: 'Fraunces', serif;
  font-size: 20px; color: var(--deep-brown);
}

.save-sub {
  font-size: 14px; color: var(--text-light);
}

/* ‚îÄ‚îÄ MEDICATION INPUT ‚îÄ‚îÄ */
.med-input-row {
  display: flex; gap: 8px;
  width: 100%; max-width: 360px;
  margin-bottom: 10px;
}

.med-input-row .input-field {
  flex: 1; margin-bottom: 0;
}

.med-add-btn {
  width: 52px; height: 52px; flex-shrink: 0;
  background: var(--terracotta); color: white;
  border: none; border-radius: 14px;
  font-size: 22px; cursor: pointer;
  transition: all 0.2s;
}

.med-add-btn:hover { opacity: 0.85; }

.med-tags {
  display: flex; flex-wrap: wrap; gap: 8px;
  width: 100%; max-width: 360px;
  margin-bottom: 12px;
  min-height: 10px;
}

.med-tag {
  background: rgba(196,113,74,0.1);
  border: 1.5px solid rgba(196,113,74,0.2);
  border-radius: 20px;
  padding: 6px 12px;
  font-size: 13px; color: var(--terracotta);
  display: flex; align-items: center; gap: 6px;
  cursor: pointer;
  transition: all 0.15s;
}

.med-tag:hover { background: rgba(196,113,74,0.2); }
.med-tag .remove { font-size: 15px; opacity: 0.6; }
</style>
</head>
<body>

<!-- SVG MASCOTS (r√©utilis√©s depuis vitalia-app.html) -->
<svg style="display:none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol id="goji" viewBox="0 0 80 80">
      <ellipse cx="40" cy="48" rx="22" ry="24" fill="#C0392B"/>
      <ellipse cx="40" cy="46" rx="20" ry="22" fill="#E74C3C"/>
      <ellipse cx="33" cy="38" rx="6" ry="4" fill="rgba(255,255,255,0.3)" transform="rotate(-20 33 38)"/>
      <ellipse cx="28" cy="27" rx="8" ry="4" fill="#27AE60" transform="rotate(-30 28 27)"/>
      <ellipse cx="52" cy="26" rx="8" ry="4" fill="#2ECC71" transform="rotate(30 52 26)"/>
      <rect x="38" y="22" width="4" height="8" rx="2" fill="#8B6914"/>
      <circle cx="34" cy="47" r="3.5" fill="#000" opacity="0.7"/>
      <circle cx="46" cy="47" r="3.5" fill="#000" opacity="0.7"/>
      <circle cx="35" cy="46" r="1.2" fill="white"/>
      <circle cx="47" cy="46" r="1.2" fill="white"/>
      <path d="M34 55 Q40 61 46 55" stroke="#8B0000" stroke-width="2" fill="none" stroke-linecap="round"/>
      <circle cx="28" cy="51" r="4" fill="rgba(255,180,180,0.5)"/>
      <circle cx="52" cy="51" r="4" fill="rgba(255,180,180,0.5)"/>
      <path d="M20 52 L18 70 L40 64 L62 70 L60 52 Q40 60 20 52Z" fill="#8B0000" opacity="0.8"/>
    </symbol>
    <symbol id="curcuma" viewBox="0 0 80 80">
      <ellipse cx="40" cy="50" rx="18" ry="20" fill="#E67E22"/>
      <ellipse cx="40" cy="48" rx="16" ry="18" fill="#F39C12"/>
      <ellipse cx="56" cy="52" rx="10" ry="8" fill="#E67E22"/>
      <ellipse cx="24" cy="55" rx="9" ry="7" fill="#E67E22"/>
      <ellipse cx="55" cy="52" rx="8" ry="6" fill="#F0A500"/>
      <ellipse cx="25" cy="55" rx="7" ry="5" fill="#F0A500"/>
      <ellipse cx="40" cy="33" rx="20" ry="6" fill="#8B6914"/>
      <rect x="28" y="20" width="24" height="14" rx="4" fill="#6B4F0A"/>
      <rect x="30" y="22" width="20" height="10" rx="3" fill="#8B6914"/>
      <text x="34" y="30" font-size="7" fill="#F1C40F">‚ú¶</text>
      <circle cx="35" cy="46" r="3" fill="#000" opacity="0.7"/>
      <circle cx="45" cy="46" r="3" fill="#000" opacity="0.7"/>
      <circle cx="36" cy="45" r="1" fill="white"/>
      <circle cx="46" cy="45" r="1" fill="white"/>
      <path d="M33 53 Q40 58 47 53" stroke="#7D5A00" stroke-width="2" fill="none" stroke-linecap="round"/>
    </symbol>
    <symbol id="avocat" viewBox="0 0 80 80">
      <ellipse cx="40" cy="50" rx="20" ry="26" fill="#166534"/>
      <ellipse cx="40" cy="52" rx="18" ry="24" fill="#16A34A"/>
      <ellipse cx="40" cy="55" rx="13" ry="17" fill="#BBF7D0"/>
      <ellipse cx="40" cy="57" rx="10" ry="13" fill="#86EFAC"/>
      <ellipse cx="40" cy="60" rx="7" ry="9" fill="#92400E"/>
      <ellipse cx="40" cy="59" rx="5" ry="7" fill="#A16207"/>
      <rect x="26" y="40" width="12" height="8" rx="4" fill="#0F172A"/>
      <rect x="42" y="40" width="12" height="8" rx="4" fill="#0F172A"/>
      <line x1="38" y1="44" x2="42" y2="44" stroke="#334155" stroke-width="2"/>
      <path d="M33 55 Q40 61 47 55" stroke="#14532D" stroke-width="2.5" fill="none" stroke-linecap="round"/>
      <rect x="38" y="22" width="4" height="10" rx="2" fill="#166534"/>
    </symbol>
  </defs>
</svg>

<!-- PROGRESS BAR -->
<div class="progress-bar">
  <div class="progress-fill" id="progressFill" style="width: 10%"></div>
</div>

<!-- STEP DOTS -->
<div class="step-counter" id="stepCounter"></div>

<!-- SKIP BUTTON -->
<button class="skip-btn hidden" id="skipBtn" onclick="skipStep()">Passer ‚Üí</button>

<!-- SAVE OVERLAY -->
<div class="save-overlay" id="saveOverlay">
  <div class="save-spinner"></div>
  <div class="save-text">Cr√©ation de ton profil... üåø</div>
  <div class="save-sub">Vitalia apprend √† te conna√Ætre</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- SCREENS                                    -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screens-wrapper">

  <!-- ‚îÄ‚îÄ √âCRAN 0 : BIENVENUE ‚îÄ‚îÄ -->
  <div class="screen active" id="screen-0">
    <div class="welcome-hero">
      <div class="app-logo">Vita<span>lia</span></div>
      <div class="app-tagline">Ton compagnon bien-√™tre</div>

      <div class="welcome-mascots">
        <div class="welcome-mascot">
          <svg width="70" height="70"><use href="#goji"/></svg>
        </div>
        <div class="welcome-mascot">
          <svg width="86" height="86"><use href="#curcuma"/></svg>
        </div>
        <div class="welcome-mascot">
          <svg width="70" height="70"><use href="#avocat"/></svg>
        </div>
      </div>

      <div class="screen-title">Bienvenue ! üëã</div>
      <div class="screen-subtitle">
        Nous allons cr√©er ton profil bien-√™tre personnalis√© en quelques minutes.<br><br>
        <strong>Toutes les questions sont optionnelles</strong> ‚Äî r√©ponds uniquement ce que tu veux partager.
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 1 : PR√âNOM ‚îÄ‚îÄ -->
  <div class="screen" id="screen-1">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#goji"/></svg>
      <div class="mascot-bubble">Commen√ßons par faire connaissance ! üòä</div>
    </div>
    <div class="screen-title">Comment tu t'appelles ?</div>
    <div class="screen-subtitle">Pour que Vitalia puisse te parler personnellement</div>
    <input class="input-field" type="text" id="prenom" placeholder="Ton pr√©nom..." autocomplete="given-name"/>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 2 : √ÇGE & SEXE ‚îÄ‚îÄ -->
  <div class="screen" id="screen-2">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#curcuma"/></svg>
      <div class="mascot-bubble">Ces infos m'aident √† ajuster les recommandations !</div>
    </div>
    <div class="screen-title">Ton profil de base</div>
    <div class="screen-subtitle">Pour des recommandations adapt√©es √† toi</div>

    <div class="input-row">
      <input class="input-field" type="number" id="age" placeholder="√Çge" min="10" max="120"/>
      <select class="input-field" id="sexe">
        <option value="">Sexe...</option>
        <option value="femme">Femme</option>
        <option value="homme">Homme</option>
        <option value="autre">Autre</option>
      </select>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 3 : OBJECTIFS ‚îÄ‚îÄ -->
  <div class="screen" id="screen-3">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#avocat"/></svg>
      <div class="mascot-bubble">Qu'est-ce qui t'a amen√© vers Vitalia ? üéØ</div>
    </div>
    <div class="screen-title">Tes objectifs bien-√™tre</div>
    <div class="screen-subtitle">S√©lectionne tout ce qui te correspond (plusieurs choix possibles)</div>

    <div class="chips-grid" id="objectifsChips">
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'energie')">‚ö° √ânergie</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'stress')">üòå Anti-stress</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'sommeil')">üåô Sommeil</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'digestion')">üåÄ Digestion</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'immunite')">üõ°Ô∏è Immunit√©</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'inflammation')">üî• Inflammation</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'peau')">‚ú® Peau & Beaut√©</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'hormones')">‚öñÔ∏è √âquilibre hormonal</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'poids')">üåø Gestion du poids</div>
      <div class="chip" onclick="toggleChip(this, 'objectifs', 'concentration')">üß† Concentration</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 4 : R√âGIMES ‚îÄ‚îÄ -->
  <div class="screen" id="screen-4">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#goji"/></svg>
      <div class="mascot-bubble">Je m'adapte √† 100% √† tes habitudes alimentaires !</div>
    </div>
    <div class="screen-title">R√©gimes alimentaires</div>
    <div class="screen-subtitle">Vitalia respectera ces contraintes dans toutes ses suggestions</div>

    <div class="chips-grid">
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'vegan')">üå± V√©gan</div>
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'vegetarien')">ü•ï V√©g√©tarien</div>
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'sans_gluten')">üåæ Sans gluten</div>
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'sans_lactose')">ü•õ Sans lactose</div>
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'keto')">ü•ë K√©to</div>
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'paleo')">üçñ Pal√©o</div>
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'halal')">‚ò™Ô∏è Halal</div>
      <div class="chip chip-sage" onclick="toggleChip(this, 'regimes', 'casher')">‚ú°Ô∏è Casher</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 5 : ALLERGIES ‚îÄ‚îÄ -->
  <div class="screen" id="screen-5">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#curcuma"/></svg>
      <div class="mascot-bubble">Ta s√©curit√© est ma priorit√© absolue ! üîí</div>
    </div>
    <div class="screen-title">Allergies & intol√©rances</div>
    <div class="screen-subtitle">Ces √©l√©ments seront automatiquement exclus de toutes tes recommandations</div>

    <div class="chips-grid">
      <div class="chip" onclick="toggleChip(this, 'allergies', 'gluten')">üåæ Gluten</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'lactose')">ü•õ Lactose</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'arachides')">ü•ú Arachides</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'noix')">üå∞ Noix & fruits √† coque</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'soja')">üåø Soja</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'oeufs')">ü•ö ≈íufs</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'poisson')">üêü Poisson</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'crustaces')">ü¶ê Crustac√©s</div>
      <div class="chip" onclick="toggleChip(this, 'allergies', 'sesame')">üå± S√©same</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 6 : GROSSESSE / GROUPE SANGUIN ‚îÄ‚îÄ -->
  <div class="screen" id="screen-6">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#avocat"/></svg>
      <div class="mascot-bubble">Ces infos me permettent d'adapter finement les conseils üå∏</div>
    </div>
    <div class="screen-title">Sant√© & groupe sanguin</div>
    <div class="screen-subtitle">Optionnel ‚Äî mais tr√®s utile pour personnaliser encore plus</div>

    <div class="toggle-card" id="toggle-enceinte" onclick="toggleCard(this, 'enceinte')">
      <div class="toggle-card-left">
        <div class="toggle-card-emoji">ü§∞</div>
        <div class="toggle-card-text">
          <strong>Grossesse</strong>
          <span>Pr√©cautions maximales activ√©es</span>
        </div>
      </div>
      <div class="toggle-switch"></div>
    </div>

    <div class="toggle-card" id="toggle-allaitement" onclick="toggleCard(this, 'allaitement')">
      <div class="toggle-card-left">
        <div class="toggle-card-emoji">üçº</div>
        <div class="toggle-card-text">
          <strong>Allaitement</strong>
          <span>Certains compl√©ments adapt√©s</span>
        </div>
      </div>
      <div class="toggle-switch"></div>
    </div>

    <div style="width:100%; max-width:360px; margin-top: 20px; margin-bottom: 10px;">
      <div class="screen-subtitle" style="margin-bottom: 14px; text-align: left;">ü©∏ Groupe sanguin (optionnel)</div>
      <div class="blood-grid">
        <div class="blood-chip" onclick="selectBlood(this, 'A+')">A+<span class="blood-sub">Rh+</span></div>
        <div class="blood-chip" onclick="selectBlood(this, 'A-')">A‚àí<span class="blood-sub">Rh‚àí</span></div>
        <div class="blood-chip" onclick="selectBlood(this, 'B+')">B+<span class="blood-sub">Rh+</span></div>
        <div class="blood-chip" onclick="selectBlood(this, 'B-')">B‚àí<span class="blood-sub">Rh‚àí</span></div>
        <div class="blood-chip" onclick="selectBlood(this, 'AB+')">AB+<span class="blood-sub">Rh+</span></div>
        <div class="blood-chip" onclick="selectBlood(this, 'AB-')">AB‚àí<span class="blood-sub">Rh‚àí</span></div>
        <div class="blood-chip" onclick="selectBlood(this, 'O+')">O+<span class="blood-sub">Rh+</span></div>
        <div class="blood-chip" onclick="selectBlood(this, 'O-')">O‚àí<span class="blood-sub">Rh‚àí</span></div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 7 : M√âDICAMENTS ‚îÄ‚îÄ -->
  <div class="screen" id="screen-7">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#goji"/></svg>
      <div class="mascot-bubble">Je v√©rifierai les interactions automatiquement üíä</div>
    </div>
    <div class="screen-title">M√©dicaments actuels</div>
    <div class="screen-subtitle">
      Vitalia excluera automatiquement les compl√©ments qui peuvent interagir.<br>
      <em style="font-size: 12px; color: var(--text-light);">Nom commercial ou g√©n√©rique, ex: Levothyrox, Aspirine...</em>
    </div>

    <div class="warning-card">
      <span>‚ö†Ô∏è</span>
      <span>Cette information est trait√©e localement et n'est pas partag√©e. Consulte toujours ton m√©decin avant d'ajouter un compl√©ment.</span>
    </div>

    <div class="med-input-row">
      <input class="input-field" type="text" id="medInput" placeholder="Nom du m√©dicament..." onkeydown="if(event.key==='Enter') ajouterMed()"/>
      <button class="med-add-btn" onclick="ajouterMed()">+</button>
    </div>

    <div class="med-tags" id="medTags"></div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 8 : BUDGET & TEMPS ‚îÄ‚îÄ -->
  <div class="screen" id="screen-8">
    <div class="mascot-container">
      <svg class="mascot-svg"><use href="#curcuma"/></svg>
      <div class="mascot-bubble">Je m'adapte √† ton quotidien r√©el üç≥</div>
    </div>
    <div class="screen-title">Budget & temps de cuisine</div>
    <div class="screen-subtitle">Pour des recommandations vraiment r√©alistes</div>

    <div class="slider-container">
      <div class="slider-value"><span id="budgetVal">15</span> <span class="slider-unit">‚Ç¨ / jour</span></div>
      <div class="slider-label">
        <span>5‚Ç¨ √©conomique</span>
        <span>50‚Ç¨ premium</span>
      </div>
      <input type="range" id="budgetSlider" min="5" max="50" value="15"
        oninput="updateSlider('budget', this.value)"
        style="--pct: 22%"/>
    </div>

    <div class="slider-container" style="margin-top: 10px;">
      <div class="slider-value"><span id="tempsVal">30</span> <span class="slider-unit">min max par repas</span></div>
      <div class="slider-label">
        <span>5 min express</span>
        <span>90 min chef</span>
      </div>
      <input type="range" id="tempsSlider" min="5" max="90" step="5" value="30"
        oninput="updateSlider('temps', this.value)"
        style="--pct: 29%"/>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ √âCRAN 9 : SUCC√àS ‚îÄ‚îÄ -->
  <div class="screen" id="screen-9">
    <div class="success-circle">üéâ</div>
    <div class="screen-title">Profil cr√©√© ! üåø</div>
    <div class="screen-subtitle">Vitalia conna√Æt maintenant tes besoins. Voici un r√©sum√© :</div>

    <div class="profile-summary" id="profileSummary"></div>

    <div style="font-size: 13px; color: var(--text-light); text-align: center; max-width: 300px;">
      Tu pourras modifier ton profil √† tout moment depuis les param√®tres ‚öôÔ∏è
    </div>
  </div>

</div>

<!-- NAV BUTTONS -->
<div class="nav-bar">
  <button class="btn-back hidden" id="backBtn" onclick="goBack()">‚Üê</button>
  <button class="btn-next" id="nextBtn" onclick="goNext()">
    <span id="nextLabel">Commencer ‚ú®</span>
  </button>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIGURATION SUPABASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPABASE_URL = 'https://ptzmyuugxhsbrynjwlhp.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0em15dXVneGhzYnJ5bmp3bGhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNDY1NjUsImV4cCI6MjA4NTYyMjU2NX0.Pel8am6iplwwFSqolEV7JOG6nxsOx4BxxJPLsObRC-4' // ‚Üê m√™me cl√© que vitalia-app.html

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentStep = 0
const TOTAL_STEPS = 10 // 0 √† 9

const profil = {
  prenom: '',
  age: null,
  sexe: '',
  objectifs: [],
  regimes_alimentaires: [],
  allergies: [],
  enceinte: false,
  allaitement: false,
  groupe_sanguin: null,
  medications_actuelles: [],
  budget_max: 15,
  temps_max: 30,
  niveau_activite: 'modere',
  pathologies_chroniques: []
}

// Questions skippables (toutes sauf 0 et 9)
const SKIPPABLE = [1, 2, 3, 4, 5, 6, 7, 8]

// Labels du bouton suivant
const NEXT_LABELS = {
  0: 'Commencer ‚ú®',
  1: 'Continuer ‚Üí',
  2: 'Continuer ‚Üí',
  3: 'Continuer ‚Üí',
  4: 'Continuer ‚Üí',
  5: 'Continuer ‚Üí',
  6: 'Continuer ‚Üí',
  7: 'Continuer ‚Üí',
  8: 'Cr√©er mon profil üåø',
  9: 'Voir mon plan du jour ! ‚Üí'
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  renderDots()
  updateUI()
})

function renderDots() {
  const container = document.getElementById('stepCounter')
  container.innerHTML = ''
  // Afficher seulement les √©tapes 1-8 (pas welcome ni succ√®s)
  for (let i = 1; i <= 8; i++) {
    const dot = document.createElement('div')
    dot.className = 'step-dot'
    dot.id = `dot-${i}`
    container.appendChild(dot)
  }
}

function updateUI() {
  // Progress bar
  const pct = ((currentStep) / (TOTAL_STEPS - 1)) * 100
  document.getElementById('progressFill').style.width = pct + '%'

  // Dots
  for (let i = 1; i <= 8; i++) {
    const dot = document.getElementById(`dot-${i}`)
    if (!dot) continue
    dot.className = 'step-dot'
    if (i < currentStep) dot.classList.add('done')
    else if (i === currentStep) dot.classList.add('active')
  }

  // Boutons
  const backBtn = document.getElementById('backBtn')
  const skipBtn = document.getElementById('skipBtn')
  const nextLabel = document.getElementById('nextLabel')

  backBtn.classList.toggle('hidden', currentStep === 0)
  skipBtn.classList.toggle('hidden', !SKIPPABLE.includes(currentStep))
  nextLabel.textContent = NEXT_LABELS[currentStep] || 'Continuer ‚Üí'

  // Cacher dots sur welcome et succ√®s
  document.getElementById('stepCounter').style.opacity =
    (currentStep === 0 || currentStep === 9) ? '0' : '1'
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goNext() {
  if (currentStep === 8) {
    // Dernier step ‚Üí sauvegarder
    sauvegarderProfil()
    return
  }

  if (currentStep === 9) {
    // Succ√®s ‚Üí aller √† l'app principale
    window.location.href = 'index.html?profil_id=' + (window._profilId || 'new')
    return
  }

  collecterDonneeStep(currentStep)
  transitionTo(currentStep + 1)
}

function goBack() {
  if (currentStep > 0) transitionTo(currentStep - 1)
}

function skipStep() {
  transitionTo(currentStep + 1)
}

function transitionTo(nextStep) {
  const current = document.getElementById(`screen-${currentStep}`)
  const next = document.getElementById(`screen-${nextStep}`)

  if (!next) return

  current.classList.add('exit')
  current.classList.remove('active')

  setTimeout(() => {
    current.classList.remove('exit')
    next.classList.add('active')
    currentStep = nextStep
    updateUI()
  }, 200)
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COLLECTE DES DONN√âES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function collecterDonneeStep(step) {
  switch (step) {
    case 1:
      profil.prenom = document.getElementById('prenom').value.trim()
      break
    case 2:
      const ageVal = document.getElementById('age').value
      profil.age = ageVal ? parseInt(ageVal) : null
      profil.sexe = document.getElementById('sexe').value
      break
    case 8:
      profil.budget_max = parseInt(document.getElementById('budgetSlider').value)
      profil.temps_max = parseInt(document.getElementById('tempsSlider').value)
      break
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INTERACTIONS UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleChip(el, field, val) {
  el.classList.toggle('selected')
  // S√©curit√© : initialiser le tableau si undefined
  if (!Array.isArray(profil[field])) profil[field] = []
  if (el.classList.contains('selected')) {
    if (!profil[field].includes(val)) profil[field].push(val)
  } else {
    profil[field] = profil[field].filter(v => v !== val)
  }
}

function toggleCard(el, field) {
  el.classList.toggle('active')
  profil[field] = el.classList.contains('active')
}

function selectBlood(el, val) {
  document.querySelectorAll('.blood-chip').forEach(c => c.classList.remove('selected'))
  el.classList.add('selected')
  profil.groupe_sanguin = val
}

function updateSlider(type, val) {
  if (type === 'budget') {
    document.getElementById('budgetVal').textContent = val
    profil.budget_max = parseInt(val)
    const pct = ((val - 5) / 45 * 100).toFixed(0) + '%'
    document.getElementById('budgetSlider').style.setProperty('--pct', pct)
  } else {
    document.getElementById('tempsVal').textContent = val
    profil.temps_max = parseInt(val)
    const pct = ((val - 5) / 85 * 100).toFixed(0) + '%'
    document.getElementById('tempsSlider').style.setProperty('--pct', pct)
  }
}

// ‚îÄ‚îÄ M√©dicaments ‚îÄ‚îÄ
function ajouterMed() {
  const input = document.getElementById('medInput')
  const val = input.value.trim()
  if (!val) return

  if (!profil.medications_actuelles.includes(val)) {
    profil.medications_actuelles.push(val)
    renderMedTags()
  }
  input.value = ''
  input.focus()
}

function retirerMed(val) {
  profil.medications_actuelles = profil.medications_actuelles.filter(m => m !== val)
  renderMedTags()
}

function renderMedTags() {
  const container = document.getElementById('medTags')
  container.innerHTML = profil.medications_actuelles.map(m =>
    `<div class="med-tag" onclick="retirerMed('${m}')">
      üíä ${m} <span class="remove">√ó</span>
    </div>`
  ).join('')
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAUVEGARDE SUPABASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function sauvegarderProfil() {
  // Collecter les derni√®res donn√©es
  collecterDonneeStep(8)

  // Afficher overlay
  document.getElementById('saveOverlay').classList.add('active')

  // G√©n√©rer un vrai UUID v4 (compatible avec la colonne id UUID de Supabase)
  const profilId = crypto.randomUUID ? crypto.randomUUID() :
    'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
      const r = Math.random() * 16 | 0
      return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16)
    })
  window._profilId = profilId

  const profilAEnregistrer = {
    id: profilId,
    prenom: profil.prenom || null,
    age: profil.age,
    sexe: profil.sexe || null,
    enceinte: profil.enceinte,
    allaitement: profil.allaitement,
    groupe_sanguin: profil.groupe_sanguin,
    pathologies_chroniques: profil.pathologies_chroniques,
    medications_actuelles: profil.medications_actuelles,
    allergies: profil.allergies,
    regimes_alimentaires: profil.regimes_alimentaires,
    niveau_activite: profil.niveau_activite,
    objectifs_generaux: profil.objectifs,
    budget_max: profil.budget_max,
    temps_max: profil.temps_max,
    created_at: new Date().toISOString()
  }

  try {
    const response = await fetch(
      `${SUPABASE_URL}/rest/v1/profils_utilisateurs`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'apikey': SUPABASE_ANON_KEY,
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
          'Prefer': 'return=representation'  // r√©cup√©rer l'ID g√©n√©r√© par Supabase
        },
        body: JSON.stringify(profilAEnregistrer)
      }
    )

    if (!response.ok) {
      const errText = await response.text()
      console.warn('Supabase warning:', errText)
      // On continue avec l'ID local
    } else {
      // R√©cup√©rer l'UUID g√©n√©r√© par Supabase
      const inserted = await response.json()
      if (inserted && inserted[0] && inserted[0].id) {
        window._profilId = inserted[0].id
        profilAEnregistrer.id = inserted[0].id
        console.log('‚úÖ Profil sauvegard√© en BDD:', inserted[0].id)
      }
    }

    // Sauvegarder en localStorage pour la session
    localStorage.setItem('vitalia_profil_id', window._profilId)
    localStorage.setItem('vitalia_profil', JSON.stringify(profilAEnregistrer))

    console.log('‚úÖ Profil en localStorage:', window._profilId)

  } catch (err) {
    console.warn('Erreur sauvegarde (continuer quand m√™me):', err)
    localStorage.setItem('vitalia_profil_id', profilId)
    localStorage.setItem('vitalia_profil', JSON.stringify(profilAEnregistrer))
  }

  // Masquer overlay et aller √† l'√©cran succ√®s
  setTimeout(() => {
    document.getElementById('saveOverlay').classList.remove('active')
    afficherResume()
    transitionTo(9)
  }, 1800)
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// R√âSUM√â PROFIL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function afficherResume() {
  const container = document.getElementById('profileSummary')

  const nom = profil.prenom ? `Bonjour ${profil.prenom} !` : 'Profil cr√©√© !'
  document.querySelector('#screen-9 .screen-title').textContent = nom

  const rows = []

  if (profil.age) rows.push({ label: 'üéÇ √Çge', val: profil.age + ' ans' })
  if (profil.sexe) rows.push({ label: 'üë§ Profil', val: capitalize(profil.sexe) })
  if (profil.objectifs.length > 0) rows.push({ label: 'üéØ Objectifs', val: profil.objectifs.map(capitalize).join(', ') })
  if (profil.regimes_alimentaires.length > 0) rows.push({ label: 'üåø R√©gimes', val: profil.regimes_alimentaires.join(', ') })
  if (profil.allergies.length > 0) rows.push({ label: '‚ö†Ô∏è Allergies', val: profil.allergies.join(', ') })
  if (profil.groupe_sanguin) rows.push({ label: 'ü©∏ Groupe sanguin', val: profil.groupe_sanguin })
  if (profil.enceinte) rows.push({ label: 'ü§∞ Grossesse', val: 'Pr√©cautions activ√©es' })
  if (profil.medications_actuelles.length > 0) rows.push({ label: 'üíä M√©dicaments', val: profil.medications_actuelles.length + ' renseign√©(s)' })
  rows.push({ label: '‚è±Ô∏è Temps cuisine', val: profil.temps_max + ' min max' })
  rows.push({ label: 'üí∞ Budget', val: profil.budget_max + '‚Ç¨/jour' })

  if (rows.length === 0) {
    rows.push({ label: '‚ú® Profil', val: 'Pr√™t √† d√©marrer !' })
  }

  container.innerHTML = rows.map(r =>
    `<div class="summary-row">
      <span class="summary-label">${r.label}</span>
      <span class="summary-value">${r.val}</span>
    </div>`
  ).join('')
}

function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1).replace(/_/g, ' ')
}
</script>
</body>
</html>